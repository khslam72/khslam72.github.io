name: Submit Selected URLs to Google Indexing API

on:
  workflow_dispatch:
    inputs:
      urls:
        description: "Enter one or more URLs to index (separate by spaces)"
        required: true
        default: "https://kcontents.site/example-post/"

jobs:
  indexing:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Authenticate to Google Cloud
        uses: google-github-actions/auth@v1
        with:
          credentials_json: '${{ secrets.SERVICE_ACCOUNT_KEY }}'

      - name: Submit Selected URLs
        run: |
          echo "URLs to index: ${{ github.event.inputs.urls }}"
          for url_to_index in ${{ github.event.inputs.urls }}; do
            echo "Submitting: $url_to_index"
            response_code=$(curl -s -o /dev/null -w "%{http_code}" -X POST "https://indexing.googleapis.com/v3/urlNotifications:publish" \
              -H "Authorization: Bearer $(gcloud auth print-access-token)" \
              -H "Content-Type: application/json" \
              --data "{ \"url\": \"$url_to_index\", \"type\": \"URL_UPDATED\" }")
            echo "Google API response: $response_code"
            if [ "$response_code" -eq 200 ]; then
              echo "✅ Successfully submitted: $url_to_index"
            else
              echo "❌ Error submitting: $url_to_index"
            fi
          done

